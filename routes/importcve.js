

var ModApp = require('../app.js');
// var ModNist = require('../import/nist')
var log = require('../log').build("importcve");
var IMPORT_CVE_CTRL = require('../controller/cve_ctrl');


module.exports.handleReq = function(req, res, next){
    log.d("handle get req");
    log.d("render")
    res.render('importcve');
}


module.exports.handlePostReq = function(req, res, next){
    log.d("handle post req");
    log.d("upload file");
    ModApp.uploadfile(req,res, 'cve', function(err) {
        if(err) {
            return res.end("Error uploading file.");
        }
        log.i(`Upload file ok, filepath ${res.req.file.path}`);
        // res.status(200).json({success:"analyzing"});
        // ModNist.parse(res.req.file.path);
        IMPORT_CVE_CTRL.importCve(res.req.file.path, "nist");
    });
}

module.exports.ROUTE_NAME = "importcve"