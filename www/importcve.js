

var ModApp = require('../app.js');
// var ModNist = require('../import/nist')
var log = require('../log').build("import");
var ModImport = require('../import/import');


module.exports.handleReq = function(app, req, res){
    log.d("handle get req");
    log.d("render")
    res.render('importcve');
}


module.exports.handlePostReq = function(app, req, res){
    log.d("handle post req");
    log.d("upload file");
    ModApp.uploadfile(req,res, 'cve', function(err) {
        if(err) {
            return res.end("Error uploading file.");
        }
        log.i(`Upload file ok, filepath ${res.req.file.path}`);
        res.status(200).json({success:"analyzing"});
        // ModNist.parse(res.req.file.path);
        ModImport.importCve(res.req.file.path, "nist");
    });
}
