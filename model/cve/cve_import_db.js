/**
 * Copyright (C) 2022 Anh Huy Ngo - All Rights Reserved
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * 
 * Author: Anh Ngo
 * Created Date: 
 */
////////////////////////////////////////////////////////////////////
// MODULE LOADING
////////////////////////////////////////////////////////////////////

const { UUID } = require('bson');
var mongoose = require('mongoose')

var COMMON = require('../../common');
////////////////////////////////////////////////////////////////////
// GLOBAL VARIABLES
////////////////////////////////////////////////////////////////////

// project include multiple domain
var schema = new mongoose.Schema({
    source:String, // import source (i.e nist, etc.)
    link:String,// link to source if exist
    vul_ids:[String], // list of vuln id imported
    vul_ids_tmp:[String], // list of vuln id imported
    author:String,// author (who/user import)
    detail:String,// information
    history:String,// history
    created_date:Number, // date of creation
    last_modified_date:Number, // date of creation
});

var model = mongoose.model("cve_import", schema);



////////////////////////////////////////////////////////////////////
// FUNCTION
////////////////////////////////////////////////////////////////////

/**
 * Add import information
 * @param {*} source 
 * @param {*} vul_list 
 * @param {*} link 
 * @param {*} author 
 * @param {*} detail 
 * @param {*} summary 
 * @param {*} created_date 
 * @param {*} history 
 * @param {*} last_modified_date 
 */
function add_import_info(source, link, author, detail)
{
    var item = new model();
    item.source = source,
    item.link = link;
    item.author = author;
    item.detail = detail;
    item.created_date = COMMON.currentTimeMs();
    item.last_modified_date = COMMON.currentTimeMs();
    item.history = buildhistory("", "Add new");
    await item.save();
}

function add_vul_ids(id, vul_ids, istmp=true){

}

function buildhistory(history, msg){
    var new_history = `${history};${msg}`;
    // TODO: limit size of history
    return new_history;
}

////////////////////////////////////////////////////////////////////
// MODULE EXPORT
////////////////////////////////////////////////////////////////////


module.exports = model
module.exports.add_import_info = add_import_info;